"use strict";(this.webpackChunkdiscord_app=this.webpackChunkdiscord_app||[]).push([["70112"],{850085:function(e,t,n){n.d(t,{default:()=>A}),n(47120),n(411104);var i=n(200651),o=n(192379),a=n(392711),r=n(36793),l=n(481060),s=n(100527),c=n(906732),u=n(540059),d=n(488499),_=n(222062),m=n(530329),g=n(626135),h=n(197712),p=n(511004),x=n(486324),f=n(981631),C=n(678916),v=n(388032),E=n(2382);let A=e=>{let{file:t,imgURI:n,transitionState:A,allowSkip:b=!1,onCrop:N,onClose:R,uploadType:w=x.pC.AVATAR,showUpsellHeader:y=!1,analyticsPage:k}=e,[L,B]=o.useState({width:0,height:0}),[I,P]=o.useState({top:0,bottom:0,left:0,right:0}),[j,S]=o.useState(!1),[z,M]=o.useState(1),[Z,D]=o.useState({x:0,y:0}),[U,T]=o.useState(null),[G,O]=o.useState(!1),{analyticsLocations:V}=(0,c.ZP)(s.Z.IMAGE_CROPPING_MODAL),H=(0,u.Q3)("ImageCroppingNModal"),F=o.useRef({x:0,y:0}),W=o.useRef(null),X=o.useRef(null),K="image/gif"===t.type;o.useEffect(()=>{(0,p.Z)()},[]),o.useEffect(()=>{K&&y&&g.default.track(f.rMx.OPEN_MODAL,{type:f.jXE.CROP_GIF_MODAL,location:{page:k}})},[y,k,K]);let Y=()=>{switch(w){case x.pC.BANNER:return{height:x.f,width:x.L0};case x.pC.VIDEO_BACKGROUND:return C.HE;case x.pC.AVATAR:case x.pC.AVATAR_DECORATION:return{height:f.dGM,width:f.dGM};case x.pC.GUILD_BANNER:return{height:x._T,width:x.X_};case x.pC.SCHEDULED_EVENT_IMAGE:return{height:x.xT,width:x.d6};case x.pC.HOME_HEADER:return{height:x.Uo,width:x.N8}}},q=o.useCallback((e,t,n)=>{F.current=(0,h.U$)(e,t,n),null!=W.current&&(W.current.style.transform="translate3d(".concat(F.current.x,"px, ").concat(F.current.y,"px, 0)"))},[W]),Q=o.useCallback(()=>{if(null==W.current||z>1)return;let{width:e,height:t}=W.current.getBoundingClientRect(),{width:n,height:i}=(0,h.Es)(w,e,t,H),o=(0,h.AK)(w,n,i,t,H);T({width:n,height:i}),B(o),P((0,h.kH)(n,i,o))},[H,w,z]),$=o.useCallback(e=>{let{x:t,y:n}=F.current;if(j&&(e.clientX!==t||e.clientY!==n))q(e.clientX-Z.x,e.clientY-Z.y,I)},[I,j,Z,q]),J=()=>{S(!1)},ee=()=>{let e=Y();return e.width!==e.height},et=async()=>{let e;if(null==W.current)return;O(!0);let n=W.current,i=Y();if(K)try{let{result:o,cancelFn:a}=await (0,h.$p)({file:t,image:n,cropDimensions:L,cropOriginCoordinates:F.current,maxDimensions:i});X.current=a,e=await o,X.current=null}catch(e){var o;throw null===(o=X.current)||void 0===o||o.call(X),X.current=null,Error("Error cropping GIF")}else e=(0,r.PT)({image:n,cropDimensions:L,cropOriginCoordinates:F.current,maxDimensions:i});await N(e,t),O(!1),R()};o.useEffect(()=>(window.addEventListener("mouseup",J),window.addEventListener("resize",Q),()=>{window.removeEventListener("mouseup",J),window.removeEventListener("resize",Q)}),[Q]),o.useEffect(()=>()=>{null!=X.current&&X.current()},[]),o.useEffect(()=>{if(j)return window.addEventListener("mousemove",$),()=>window.removeEventListener("mousemove",$)},[$,j]);let en=w===x.pC.AVATAR||w===x.pC.BANNER,ei=(0,_.M)(!en);return(0,i.jsx)(c.Gt,{value:V,children:(0,i.jsxs)(l.Y0X,{onAnimationEnd:Q,transitionState:A,size:l.CgR.MEDIUM,children:[y&&!ei&&(0,i.jsx)(d.Z,{type:w,analyticsPage:k,analyticsSection:f.jXE.CROP_GIF_MODAL,isGIF:K,banner:n}),(0,i.jsx)(l.xBx,{separator:!1,children:(0,i.jsx)(l.vwX,{className:E.titleCase,tag:l.RB0.H1,children:v.intl.string(v.t.DxAYCA)})}),(0,i.jsxs)(l.hzk,{className:E.modalContent,children:[(0,i.jsxs)("div",{className:E.editingContainer,children:[(0,i.jsx)("img",{style:{opacity:null==U?0:1,transform:"translate3d(".concat(F.current.x,"px, ").concat(F.current.y,"px, 0px)"),...(()=>{if(null==U)return{};let e=U.width/U.height,t=ee()&&e>x.MY?L.height/U.height:1;return{width:U.width*z*t,minWidth:U.width*z*t,height:U.height*z*t}})()},className:G?E.imageDisabled:E.imageEnabled,src:n,alt:"avatar",ref:W,onMouseDown:e=>{D({x:e.clientX-F.current.x,y:e.clientY-F.current.y}),S(!0)},draggable:!1}),(0,i.jsx)("div",{className:w===x.pC.AVATAR?E.overlayAvatar:E.overlayBanner,style:{opacity:null==U?0:1,width:L.width,height:L.height}})]}),(0,i.jsxs)("div",{className:E.sliderContainer,children:[(0,i.jsx)(l.XBm,{size:"md",color:"currentColor",className:E.icon}),(0,i.jsx)(l.iRW,{initialValue:1,minValue:1,maxValue:2,keyboardStep:.025,asValueChanges:e=>{if(null==U)return;let{width:t,height:n}=U,i=(0,h.kH)(t*e,n*e,L),{x:o,y:r}=F.current;(0,a.inRange)(o,i.right,i.left)&&(0,a.inRange)(r,i.top,i.bottom)||q(o,r,i),M(e),P(i)},disabled:G,equidistant:!0,hideBubble:!0,"aria-label":v.intl.string(v.t.dnvZSk)}),(0,i.jsx)(l.XBm,{size:"custom",color:"currentColor",className:E.icon,width:48,height:48})]}),y&&ei&&(0,i.jsx)("div",{children:(0,i.jsx)(m.Z,{uploadType:w,showUpsell:!0,position:"inline",className:E.nitroUpsell,showShadow:!1})})]}),(0,i.jsxs)(l.mzw,{className:E.modalFooter,children:[b?(0,i.jsx)(l.zxk,{className:E.cancelButton,look:l.zxk.Looks.LINK,color:l.zxk.Colors.PRIMARY,size:l.PhG.SMALL,onClick:()=>{b&&(N(n,t),R())},children:v.intl.string(v.t.B944ys)}):null,(0,i.jsxs)("div",{className:E.buttonsRight,children:[(0,i.jsx)(l.zxk,{className:E.cancelButton,look:l.zxk.Looks.LINK,color:l.zxk.Colors.PRIMARY,size:l.PhG.SMALL,onClick:()=>{if(null!=X.current){X.current(),X.current=null,O(!1);return}R()},children:v.intl.string(v.t["9TG40t"])}),(0,i.jsx)(l.zxk,{submitting:G,size:l.PhG.SMALL,onClick:et,children:v.intl.string(v.t.ZSHmKC)})]})]})]})})}},73620:function(e,t,n){n.d(t,{default:()=>l});var i=n(200651),o=n(373230),a=n(850085),r=n(712451);function l(e){let{allowSkip:t,...n}=e,{enabled:l}=o.i3.useExperiment({location:"ImageEditingModalExperimentWrapper"},{autoTrackExposure:!1});return l?(0,i.jsx)(r.default,{...n}):(0,i.jsx)(a.default,{...n,allowSkip:t})}},180781:function(e,t,n){n.d(t,{Z:()=>p});var i=n(200651);n(192379);var o=n(442837),a=n(481060),r=n(906732),l=n(48217),s=n(26323),c=n(430824),u=n(914010),d=n(709586),_=n(981631),m=n(30513),g=n(388032),h=n(160455);function p(e){let{analyticsSection:t,analyticsPage:n,isGIF:p,banner:x}=e,f=(0,o.e7)([u.Z],()=>u.Z.getGuildId()),C=(0,o.e7)([c.Z],()=>c.Z.getGuild(f)),{analyticsLocations:v}=(0,r.ZP)();return null==C||C.hasFeature(_.oNc.ANIMATED_BANNER)||!p&&C.hasFeature(_.oNc.BANNER)?null:(0,i.jsxs)("div",{className:h.container,children:[(0,i.jsx)(d.Z,{className:h.guildBoostingIcon}),(0,i.jsx)(a.Text,{color:"header-primary",variant:"text-sm/semibold",children:g.intl.string(g.t["56M7xc"])}),(0,i.jsx)(a.zxk,{look:a.zxk.Looks.LINK,color:a.zxk.Colors.LINK,className:h.subscribeButton,onClick:()=>{if(null==C)return;let e={section:t,page:n,object:_.qAy.UPSELL_HEADER};null!=x?(0,l.c)({analyticsLocations:v,analyticsLocation:e,guild:C,isGIF:p,banner:x}):(0,s.Z)({analyticsLocations:v,analyticsSourceLocation:e,guild:C,perks:p?(0,m.zC)():(0,m.XO)()})},children:g.intl.string(g.t.WUHdZW)})]})}},321867:function(e,t,n){n.d(t,{Z:()=>v});var i=n(200651),o=n(192379),a=n(442837),r=n(481060),l=n(100527),s=n(906732),c=n(118012),u=n(411477),d=n(197115),_=n(594174),m=n(626135),g=n(74538),h=n(981631),p=n(486324),x=n(474936),f=n(388032),C=n(832924);function v(e){let{analyticsSection:t,type:n}=e,v=(0,a.e7)([_.default],()=>_.default.getCurrentUser()),E=g.ZP.canUseAnimatedAvatar(v),A=g.ZP.canUsePremiumProfileCustomization(v),b=n===p.pC.BANNER&&A||n===p.pC.AVATAR&&E,{sourceAnalyticsLocations:N}=(0,s.ZP)(l.Z.PREMIUM_PREVIEW_UPSELL_HEADER);if(o.useEffect(()=>{b||m.default.track(h.rMx.PREMIUM_UPSELL_VIEWED,{type:t,location_stack:N})},[b,t,N]),b)return null;let R=(0,i.jsx)(d.Z,{className:C.__invalid_getNitroLink,size:r.zxk.Sizes.SMALL,look:r.zxk.Looks.LINK,color:r.zxk.Colors.LINK,subscriptionTier:x.Si.TIER_2,buttonText:f.intl.format(f.t["944tDg"],{}),showIcon:!1,premiumModalAnalyticsLocation:{section:t,object:h.qAy.BUTTON_CTA},disableShine:!0});return(0,i.jsx)(u.Z,{reducedRightPadding:!0,className:C.nitroPreviewUpsell,text:f.intl.format(f.t.Og8039,{}),textSize:c.Z.Sizes.SIZE_14,textColor:c.Z.Colors.HEADER_PRIMARY,button:R})}},488499:function(e,t,n){n.d(t,{Z:()=>l});var i=n(200651);n(192379);var o=n(180781),a=n(321867),r=n(486324);function l(e){let{type:t,analyticsPage:n,analyticsSection:l,isGIF:s,banner:c}=e;return[r.pC.BANNER,r.pC.AVATAR].includes(t)&&s?(0,i.jsx)(a.Z,{analyticsSection:l,type:t}):t===r.pC.GUILD_BANNER?(0,i.jsx)(o.Z,{analyticsSection:l,analyticsPage:n,isGIF:s,banner:c}):null}},411477:function(e,t,n){n.d(t,{Z:()=>u});var i=n(200651);n(192379);var o=n(120356),a=n.n(o),r=n(481060),l=n(436774),s=n(118012),c=n(575149);function u(e){let{text:t,textSize:n=s.Z.Sizes.SIZE_12,textColor:o=s.Z.Colors.STANDARD,className:u,button:d,reducedRightPadding:_=!1}=e;return(0,i.jsxs)("div",{className:a()(_?c.noticeWithoutRightPadding:c.noticeWithRightPadding,u),children:[(0,i.jsxs)("div",{className:c.noticeLeft,children:[(0,i.jsx)(r.SrA,{size:"md",className:c.icon,color:l.JX.PREMIUM_TIER_2}),(0,i.jsx)(s.Z,{className:c.text,size:n,color:o,children:t})]}),d]})}},373230:function(e,t,n){n.d(t,{Tq:()=>a,i3:()=>r});var i=n(818083);let o=(0,i.B)({kind:"user",id:"2025-01_recent_avatars",label:"Recent Avatars",defaultConfig:{enabled:!1},treatments:[{id:1,label:"Allow users to select from recently uploaded avatars",config:{enabled:!0}}]});function a(e){let{location:t,autoTrackExposure:n=!0}=e,{enabled:i}=o.useExperiment({location:t},{autoTrackExposure:n});return i}let r=(0,i.B)({kind:"user",id:"2025-02_improved_image_upload_flow",label:"Improved Image Upload Flow",defaultConfig:{enabled:!1},treatments:[{id:1,label:"QOL improvements to the image upload and edit flow used for profile assets, server banners & icons, etc.",config:{enabled:!0}}]})},2382:function(e,t,n){e.exports={modalContent:"modalContent__11787",editingContainer:"editingContainer__11787",image:"image__11787",imageEnabled:"imageEnabled__11787 image__11787",imageDisabled:"imageDisabled__11787 image__11787",icon:"icon__11787",overlay:"overlay__11787",overlayAvatar:"overlayAvatar__11787 overlay__11787",overlayBanner:"overlayBanner__11787 overlay__11787",sliderContainer:"sliderContainer__11787",nitroUpsell:"nitroUpsell__11787",cancelButton:"cancelButton__11787",modalFooter:"modalFooter__11787",buttonsRight:"buttonsRight__11787",titleCase:"titleCase__11787"}},91536:function(e,t,n){e.exports={modalHeader:"modalHeader__57752",modalCloseButton:"modalCloseButton__57752",modalContent:"modalContent__57752",editingContainer:"editingContainer__57752",image:"image__57752",rotationSupported:"rotationSupported__57752",imageEnabled:"imageEnabled__57752 image__57752",imageDisabled:"imageDisabled__57752 image__57752",overlay:"overlay__57752",overlayAvatar:"overlayAvatar__57752 overlay__57752",overlayBanner:"overlayBanner__57752 overlay__57752",toolsContainer:"toolsContainer__57752",zoomControls:"zoomControls__57752",zoomIcon:"zoomIcon__57752",slider:"slider__57752",rotateButton:"rotateButton__57752",premiumUpsell:"premiumUpsell__57752",modalFooter:"modalFooter__57752",linkButton:"linkButton__57752",resetButton:"resetButton__57752 linkButton__57752"}},160455:function(e,t,n){e.exports={container:"container_aea6af",guildBoostingIcon:"guildBoostingIcon_aea6af",subscribeButton:"subscribeButton_aea6af"}},832924:function(e,t,n){e.exports={nitroPreviewUpsell:"nitroPreviewUpsell_c8eb34"}},14164:function(e,t,n){e.exports={container:"container__0c185"}},575149:function(e,t,n){e.exports={notice:"notice_d37fb3",noticeWithoutRightPadding:"noticeWithoutRightPadding_d37fb3 notice_d37fb3",noticeWithRightPadding:"noticeWithRightPadding_d37fb3 notice_d37fb3",noticeLeft:"noticeLeft_d37fb3",icon:"icon_d37fb3",text:"text_d37fb3"}},170274:function(e,t,n){e.exports={modal:"modal__038c3",modalContent:"modalContent__038c3",previewContainerParent:"previewContainerParent__038c3",previewContainer:"previewContainer__038c3"}}}]);
//# sourceMappingURL=9d55095800eb5b95.js.map