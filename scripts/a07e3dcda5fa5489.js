"use strict";(this.webpackChunkdiscord_app=this.webpackChunkdiscord_app||[]).push([["22878"],{749280:function(e,n,t){t.d(n,{w:()=>d});var l=t(200651),i=t(192379),a=t(709014);let o={hover:{name:"hover",start:0,duration:59},click:{name:"click",start:68,duration:26}},d=()=>{let e=i.useRef(null),n=i.useCallback(()=>{null!=e.current&&e.current.play("click")},[]),d=i.useCallback(()=>{null!=e.current&&e.current.play("hover")},[]);return{events:{onMouseEnter:d,onMouseLeave:i.useCallback(()=>{null!=e.current&&e.current.stopIfPlaying("hover")},[])},play:n,Component:i.useCallback(n=>(0,l.jsx)(a.L,{...n,src:()=>t.e("56855").then(t.t.bind(t,206509,19)),ref:e,markers:o}),[])}}},399654:function(e,n,t){t.d(n,{a:()=>u});var l=t(544891),i=t(570140),a=t(706454),o=t(70956),d=t(844439),c=t(981631);let r=10*o.Z.Millis.MINUTE;async function u(e){let{channelId:n,location:t,withCommands:o}=e;if(null==n)return;let u=Date.now(),s=d.ZP.getFetchState({location:t,channelId:n,withCommands:o}),m=d.ZP.getLastFetchTimeMs({location:t,channelId:n,withCommands:o});if(s!==d.M.FETCHING&&(null==m||!(m+r>u))){i.Z.dispatch({type:"APP_RECOMMENDATIONS_FETCH_RECOMMENDATIONS",location:t,channelId:n,withCommands:o});try{var E;let e=await l.tn.get({url:c.ANM.APP_RECOMMENDATIONS,query:{locale:a.default.locale,channel_id:n,location:t,with_commands:o},rejectWithError:!1});i.Z.dispatch({type:"APP_RECOMMENDATIONS_FETCH_RECOMMENDATIONS_SUCCESS",location:t,channelId:n,recommendations:null!==(E=e.body)&&void 0!==E?E:[],withCommands:o})}catch(e){i.Z.dispatch({type:"APP_RECOMMENDATIONS_FETCH_RECOMMENDATIONS_FAILURE",location:t,channelId:n,withCommands:o})}}}},619895:function(e,n,t){t.d(n,{Q:()=>s,h:()=>m});var l=t(192379),i=t(228458),a=t(442837),o=t(895924),d=t(581364),c=t(823379),r=t(399654),u=t(844439);function s(e){let{contentType:n}=e;switch(n){case"image/jpeg":case"image/jpg":return".jpg";case"image/png":case"image/apng":return".png";case"image/webp":return".webp";default:return""}}function m(e){let{channelId:n}=e,{fetchState:t,recommendationsSections:s}=function(e){let{channelId:n}=e,t=i.I.CONTEXTUAL_IMAGE,o=l.useMemo(()=>({channelId:n,location:t,withCommands:!0}),[n,t]);l.useEffect(()=>{(0,r.a)(o)},[o]);let{fetchState:d,recommendationsSections:c}=(0,a.cj)([u.ZP],()=>({fetchState:u.ZP.getFetchState(o),recommendationsSections:u.ZP.getRecommendations(o)}));return{fetchState:d,recommendationsSections:c}}({channelId:n});return{fetchState:t,imageRecCommandContexts:l.useMemo(()=>{let e=s.length>0?s[0].items:void 0;if(void 0===e)return[];let n={};return e.forEach(e=>{var t;let l=null!==(t=e.command_metadata)&&void 0!==t?t:{};Object.keys(l).forEach(e=>{n[e]=l[e]})}),Object.keys(n).map(n=>{var t,l,i,a,c,r,u,s,m,E,v,p;let C,_;let h=e.find(e=>{var t;return null!=(C=null===(t=e.commands)||void 0===t?void 0:t.find(e=>e.id===n))});if(null==h)return null;let{application:g}=h;if(null==C)return null;let M=(0,d.Z8)({rootCommand:C,command:C,applicationId:g.id}),f=null===(i=h.command_metadata)||void 0===i?void 0:null===(l=i[n])||void 0===l?void 0:null===(t=l.overrideSendCommandInfo)||void 0===t?void 0:t.commandId;if(null!=f){let e=null!=f?null===(v=h.commands)||void 0===v?void 0:v.find(e=>e.id===f):void 0;null!=e&&(_=(0,d.Z8)({rootCommand:e,command:e,applicationId:g.id}))}return{command:{...M,displayName:M.displayName.split(/[_ ]/).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")},imageOption:null===(c=h.command_metadata)||void 0===c?void 0:null===(a=c[n])||void 0===a?void 0:a.imageOption,overrideSendCommand:_,overrideSendCommandInfo:null===(u=h.command_metadata)||void 0===u?void 0:null===(r=u[n])||void 0===r?void 0:r.overrideSendCommandInfo,onlyAllowEdit:null===(m=h.command_metadata)||void 0===m?void 0:null===(s=m[n])||void 0===s?void 0:s.onlyAllowEdit,section:{type:o.Qi.APPLICATION,id:g.id,icon:g.icon,name:null!==(p=null==g?void 0:null===(E=g.bot)||void 0===E?void 0:E.username)&&void 0!==p?p:g.name,application:g}}}).filter(c.lm)},[s])}}},844439:function(e,n,t){t.d(n,{M:()=>r,ZP:()=>C});var l,i,a,o,d=t(442837),c=t(570140),r=((l={})[l.FETCHING=0]="FETCHING",l[l.FETCHED=1]="FETCHED",l[l.ERROR=2]="ERROR",l);let u={},s={},m={};function E(e){let{location:n,channelId:t,withCommands:l}=e;return"location:".concat(n," channelId:").concat("0"," withCommands:").concat(l)}let v=Object.freeze([]);class p extends(o=d.ZP.Store){getLastFetchTimeMs(e){let{location:n,channelId:t,withCommands:l}=e;return m[E({location:n,channelId:t,withCommands:l})]}getFetchState(e){let{location:n,channelId:t,withCommands:l}=e;return s[E({location:n,channelId:t,withCommands:l})]}getRecommendations(e){var n;let{location:t,channelId:l,withCommands:i}=e;return null!==(n=u[E({location:t,channelId:l,withCommands:i})])&&void 0!==n?n:v}}a=void 0,(i="displayName")in p?Object.defineProperty(p,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):p[i]=a;let C=new p(c.Z,{APP_RECOMMENDATIONS_FETCH_RECOMMENDATIONS:function(e){let{location:n,channelId:t,withCommands:l}=e;s={...s,[E({location:n,channelId:t,withCommands:l})]:0}},APP_RECOMMENDATIONS_FETCH_RECOMMENDATIONS_SUCCESS:function(e){let{recommendations:n,location:t,channelId:l,withCommands:i}=e,a=E({location:t,channelId:l,withCommands:i});u={...u,[a]:n},s={...s,[a]:1};let o=Date.now();m={...m,[a]:o}},APP_RECOMMENDATIONS_FETCH_RECOMMENDATIONS_FAILURE:function(e){let{location:n,channelId:t,withCommands:l}=e;s={...s,[E({location:n,channelId:t,withCommands:l})]:2}}})},370298:function(e,n,t){t.d(n,{Z:()=>x}),t(47120),t(653041);var l=t(200651),i=t(192379),a=t(442837),o=t(749280),d=t(481060),c=t(166459),r=t(911969),u=t(476326),s=t(827498),m=t(555573),E=t(213459),v=t(998698),p=t(895924),C=t(581364),_=t(667204),h=t(873387),g=t(809090),M=t(147391),f=t(583027),N=t(978983),A=t(592125),S=t(703558),I=t(430824),T=t(626135),b=t(585483),O=t(619895),P=t(844439),R=t(981631),y=t(388032),U=t(852896);function x(e){let{toggleShowMenu:n,showMenu:t,className:c,channelId:r,imageUrl:u,mimeType:s}=e,m=(0,a.e7)([A.Z],()=>A.Z.getChannel(r)),{Component:E,events:v,play:p}=(0,o.w)(),[C,_]=i.useState(!1);return null==m?null:(C||p(),(0,l.jsx)(d.yRy,{renderPopout:e=>{let{closePopout:n}=e;return(0,l.jsx)(w,{onClose:n,channel:m,imageUrl:u,mimeType:s})},position:"right",align:"top",animation:d.yRy.Animation.NONE,onRequestClose:n,shouldShow:t,children:e=>{let{onClick:t}=e;return(0,l.jsx)(d.ua7,{text:y.intl.string(y.t.emnnEB),children:e=>(0,l.jsx)(d.P3F,{...e,className:c,focusProps:{offset:2},onClick:n,onMouseEnter:()=>{_(!0),v.onMouseEnter()},onMouseLeave:v.onMouseLeave,"aria-label":y.intl.string(y.t.emnnEB),children:(0,l.jsx)(E,{size:"custom",width:20,height:20,color:"currentColor"})})})}}))}function w(e){let{onSelect:n,onClose:t,channel:o,imageUrl:A,mimeType:x}=e,w=(0,a.e7)([I.Z],()=>I.Z.getGuild(o.guild_id)),{fetchState:j,imageRecCommandContexts:Z}=(0,O.h)({channelId:o.id}),D=j===P.M.FETCHING,F=(0,h.g)(o),L=(0,E.PL)(!0,!0),H=(0,E.LD)(o.guild_id,!0);i.useEffect(()=>{(j===P.M.ERROR||j===P.M.FETCHED&&0===Z.length)&&t()},[j,Z.length,t]),i.useEffect(()=>{var e,n;if(D||0===Z.length)return;let t=[];Z.forEach(e=>{t.push(Number(e.command.id)),null!=e.overrideSendCommand&&t.push(Number(e.overrideSendCommand.id))}),T.default.track(R.rMx.APP_IMAGE_RECS_MENU_VIEWED,{guild_id:null!==(e=null==o?void 0:o.guild_id)&&void 0!==e?e:"",channel_id:null!==(n=null==o?void 0:o.id)&&void 0!==n?n:"",application_ids:[...Z.map(e=>Number(e.command.applicationId))],command_ids:t})},[Z,o,D]);let k=i.useCallback(async e=>{let n=await fetch(A),t=await n.arrayBuffer(),l=x.join("/"),i=new File([t],"image".concat((0,O.Q)({contentType:l})),{type:l});c.Z.setFile({channelId:o.id,id:e,file:{id:e,file:i,platform:u.ow.WEB},draftType:S.d.SlashCommand})},[A,o.id,x]),G=i.useCallback(async(e,n,t,l)=>{var i,a;if(!F)return;let d=e.applicationId,c=(null===(i=L.result)||void 0===i?void 0:i.sections[d])!=null,u=(null===(a=H.result)||void 0===a?void 0:a.sections[d])!=null;await k(l),null!=v.Z.getActiveCommand(o.id)&&m.Po({channelId:o.id,command:null,section:null}),c||u||E.ZP.queryInstallOnDemandApp(e.applicationId,o.id),m.Po({channelId:o.id,command:e,section:n,location:t,source:s._b.TEXT,initialValues:{[l]:{type:r.jw.ATTACHMENT,name:l,value:"image"}},commandOrigin:t===p.Vh.IMAGE_RECS_SUBMENU?p.bB.IMAGE_RECS_SUBMENU:p.bB.IMAGE_RECS_MENU}),(0,f.Mo)({command:e,location:t,sectionName:n.name}),b.S.dispatch(R.CkL.FOCUS_CHANNEL_TEXT_AREA,{channelId:o.id})},[o.id,k,F,L,H]),B=i.useCallback(async(e,n,t)=>{var l,i;let a=e.applicationId,d=(null===(l=L.result)||void 0===l?void 0:l.sections[a])!=null,c=(null===(i=H.result)||void 0===i?void 0:i.sections[a])!=null;d||c||E.ZP.queryInstallOnDemandApp(e.applicationId,o.id);let r=await (0,M.L)({applicationId:a,userIndexState:L,guildIndexState:H,location:n,source:s._b.TEXT});(0,C.qJ)({command:e,location:n,source:s._b.TEXT}),r&&(await k(t),await (0,_.Z)({command:{...e},optionValues:{[t]:[{text:"image",type:"text"}]},context:{channel:o,guild:w},commandOrigin:n===p.Vh.IMAGE_RECS_SUBMENU?p.bB.IMAGE_RECS_SUBMENU:p.bB.IMAGE_RECS_MENU}))},[o,w,L,H,k]);return(0,l.jsxs)(d.v2r,{onSelect:n,navId:"image-context-commands-popout",onClose:t,"aria-label":y.intl.string(y.t.P3ShV1),children:[(0,l.jsx)(d.sNh,{id:"menu-image-rec-header",render:()=>(0,l.jsx)(d.Text,{className:U.title,variant:"text-md/bold",color:"header-primary",children:y.intl.string(y.t.emnnEB)}),navigable:!1,disabled:!0},"menu-image-rec-header"),(0,l.jsx)(d.Clw,{}),D?(0,l.jsx)(d.sNh,{id:"menu-image-recs-placeholder",render:()=>(0,l.jsx)(N.Z,{}),navigable:!1,disabled:!0},"menu-image-recs-placeholder"):(0,l.jsx)(l.Fragment,{children:Z.filter(e=>null!=e.imageOption).map(e=>{let n=e.overrideSendCommand,t=null==e?void 0:e.overrideSendCommandInfo,i=null!=n&&null!=t,a=e.onlyAllowEdit||null!=t&&null==n,c=e.imageOption;return null==c?null:(0,l.jsx)(d.sNh,{id:e.command.id,action:()=>{a?G(e.command,e.section,p.Vh.IMAGE_RECS_MENU,c):B(i?n:e.command,p.Vh.IMAGE_RECS_MENU,i?t.imageOption:c)},label:e.command.displayName,subtext:e.command.displayDescription,subtextLineClamp:1,icon:a?d.vdY:i?void 0:d.Uuj,iconLeft:()=>(0,l.jsx)(g.Z,{channel:o,section:e.section,width:32,height:32,isSquircle:!0,selectable:!1}),iconLeftSize:"lg",showImageFirst:!0,disabled:!F&&a,children:i?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(d.sNh,{id:"".concat(e.command.id,"-send"),label:y.intl.string(y.t["M+BhUV"]),subtext:y.intl.string(y.t.zXFjJS),action:()=>B(n,p.Vh.IMAGE_RECS_SUBMENU,t.imageOption),icon:d.Uuj},"".concat(e.command.id,"-send")),(0,l.jsx)(d.sNh,{id:"".concat(e.command.id,"-edit"),label:y.intl.string(y.t["wTaN+P"]),subtext:y.intl.string(y.t.bIB3bm),action:()=>{G(e.command,e.section,p.Vh.IMAGE_RECS_SUBMENU,c)},icon:d.vdY,disabled:!F},"".concat(e.command.id,"-edit"))]}):null},e.command.id)})})]})}},873387:function(e,n,t){t.d(n,{g:()=>u});var l=t(149765),i=t(442837),a=t(665906),o=t(271383),d=t(496675),c=t(594174),r=t(981631);function u(e){let n=e.getGuildId(),t=(0,i.e7)([o.ZP,c.default],()=>{var e,t;let l=c.default.getCurrentUser();return null!==(t=null!=n&&null!=l?null===(e=o.ZP.getMember(n,l.id))||void 0===e?void 0:e.isPending:null)&&void 0!==t&&t}),{messagesDisabled:u}=(0,i.cj)([d.Z],()=>{let n=e.isPrivate(),i=d.Z.computePermissions(e),o=l.e$(i,r.Plq.SEND_MESSAGES),c=(0,a.xl)(e);return{messagesDisabled:t||!n&&!o||c}},[e,t]);return!u}},147391:function(e,n,t){t.d(n,{L:()=>r});var l=t(373793),i=t(367907),a=t(69580),o=t(812206),d=t(981631),c=t(689079);function r(e){var n,t,r,u,s;let{applicationId:m,userIndexState:E,guildIndexState:v,sectionName:p,location:C,source:_}=e;if(m===c.bi.BUILT_IN||(null===(n=E.result)||void 0===n?void 0:n.sections[m])!=null||(null===(t=v.result)||void 0===t?void 0:t.sections[m])!=null)return Promise.resolve(!0);(0,i.yw)(d.rMx.APP_LAUNCHER_OAUTH2_AUTHORIZE_OPENED,{location:C,application_id:m,section_name:p,source:_});let h=o.Z.getApplication(m),g=l.Y.USER_INSTALL,M=null==h?void 0:null===(s=h.integrationTypesConfig)||void 0===s?void 0:null===(u=s[g])||void 0===u?void 0:null===(r=u.oauth2InstallParams)||void 0===r?void 0:r.scopes;return new Promise(e=>{(0,a.openOAuth2Modal)({clientId:m,integrationType:g,scopes:M,callback:n=>{let{location:t}=n;null!=t?((0,i.yw)(d.rMx.APP_LAUNCHER_OAUTH2_AUTHORIZE_SUCCEEDED,{location:C,application_id:m,section_name:p,source:_}),e(!0)):e(!1)}},()=>{e(!1)})})}},583027:function(e,n,t){t.d(n,{Mo:()=>d,SC:()=>r,_U:()=>c}),t(47120);var l=t(15729),i=t(877124),a=t(731965);let o=(0,l.U)((0,i.XR)(()=>({commandAnalyticsContext:new Map})));function d(e){let{command:n,location:t,sectionName:l}=e,{commandAnalyticsContext:i}=o.getState(),d=i.get(n);if(null==d||d.location!==t||d.sectionName!==l){let e=new Map(i);e.set(n,{location:t,sectionName:l}),(0,a.j)(()=>o.setState({commandAnalyticsContext:e}))}}function c(e){let{commandAnalyticsContext:n}=o.getState();return n.get(e)}function r(e){let{commandAnalyticsContext:n}=o.getState();if(n.has(e)){let t=new Map(n);t.delete(e),(0,a.j)(()=>o.setState({commandAnalyticsContext:t}))}}},947849:function(e,n,t){t.d(n,{h:()=>l});let l=t(192379).createContext(()=>null)},978983:function(e,n,t){t.d(n,{Z:()=>o});var l=t(200651);t(192379);var i=t(481060),a=t(719594);let o=()=>(0,l.jsx)("div",{className:a.loadingWrapper,children:(0,l.jsx)(i.bbz,{dotRadius:4,themed:!0})})},228458:function(e,n,t){t.d(n,{I:()=>i});var l,i=((l={}).APP_LAUNCHER_TEXT="app_launcher_text",l.APP_LAUNCHER_VOICE="app_launcher_voice",l.CONTEXTUAL_IMAGE="contextual_image",l)}}]);
//# sourceMappingURL=a07e3dcda5fa5489.js.map