"use strict";(this.webpackChunkdiscord_app=this.webpackChunkdiscord_app||[]).push([["226"],{689241:function(t,e,s){s.d(e,{q:()=>r});var l=s(544891),n=s(570140),a=s(173747),i=s(981631);async function r(t,e,s,r){if(a.Z.needsToFetchBuildSize(s)){n.Z.dispatch({type:"APPLICATION_BUILD_SIZE_FETCH_START",buildId:s});try{let a=await l.tn.post({url:i.ANM.APPLICATION_BUILD_SIZE(t,e,s),body:{manifest_ids:r},oldFormErrors:!0,rejectWithError:!0});n.Z.dispatch({type:"APPLICATION_BUILD_SIZE_FETCH_SUCCESS",buildId:s,sizeKB:a.body.size_kb})}catch(t){n.Z.dispatch({type:"APPLICATION_BUILD_SIZE_FETCH_FAIL",buildId:s})}}}},447273:function(t,e,s){s.d(e,{B:()=>n,D:()=>a});var l=s(570140);function n(){l.Z.dispatch({type:"APPLICATION_STORE_ACCEPT_STORE_TERMS"})}function a(t){l.Z.dispatch({type:"APPLICATION_STORE_ACCEPT_EULA",eulaId:t})}},325432:function(t,e,s){s.d(e,{RY:()=>a,Tb:()=>r,ec:()=>h,iD:()=>i}),s(47120);var l=s(570140),n=s(830168);function a(t){n.Z.queryDirectory(t,(e,s)=>{null==e&&null!=s&&l.Z.dispatch({type:"INSTALLATION_LOCATION_ADD",path:t,metadata:s})})}function i(t){l.Z.dispatch({type:"INSTALLATION_LOCATION_REMOVE",path:t})}function r(t,e){let{label:s,isDefault:n}=e;l.Z.dispatch({type:"INSTALLATION_LOCATION_UPDATE",path:t,label:s,isDefault:n})}function h(t){let e={},s=0;for(let a of t)null!=a&&"string"==typeof a&&n.Z.queryDirectory(a,(n,i)=>{++s,null==n&&null!=i&&(e[a]=i),s===t.length&&l.Z.dispatch({type:"INSTALLATION_LOCATION_FETCH_METADATA",metadataPayload:e})})}},472064:function(t,e,s){s.d(e,{default:()=>E}),s(47120),s(411104);var l=s(200651),n=s(192379),a=s(442837),i=s(481060),r=s(570140),h=s(57513),o=s(689241),d=s(447273),u=s(51025),c=s(672971),p=s(812206),I=s(600164),m=s(925329),g=s(703656),f=s(173747),P=s(850840),_=s(391690),T=s(424218),A=s(94692),C=s(981631),Z=s(388032),S=s(560121);function L(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class b extends n.Component{fetchInstallSize(){let{applicationId:t,branchId:e,buildId:s,manifestIds:l,buildSizeKB:n}=this.props;null!=s&&null!=l&&null==n&&r.Z.wait(()=>{(0,o.q)(t,e,s,l)})}componentDidMount(){let{applicationId:t,branchId:e,buildId:s,manifestIds:l}=this.props;null==s||null==l?(0,h.l)(t,e):this.fetchInstallSize()}componentDidUpdate(t){(this.props.buildId!==t.buildId||this.props.manifestIds!==t.manifestIds)&&this.fetchInstallSize()}componentWillUnmount(){this.isUnmounted=!0}renderButton(){let{buildId:t}=this.props,{hasError:e,hasAcceptedNeccessaryTerms:s}=this.state;return(0,l.jsx)(i.zxk,{disabled:e||null==t||!s,color:i.zxk.Colors.GREEN,onClick:this.handleInstall,children:Z.intl.string(Z.t.nL0WvL)})}render(){let{application:t,buildSizeKB:e,transitionState:s}=this.props,{selectedInstallationPath:n,isInstalling:a}=this.state,r=null!=t&&t.getSplashURL(440);return(0,l.jsxs)(i.Y0X,{transitionState:s,size:i.CgR.SMALL,"aria-label":Z.intl.string(Z.t.PphjtL),children:[null!=r?(0,l.jsx)("div",{className:S.splash,style:{backgroundImage:"url(".concat(r,")")}}):null,(0,l.jsxs)(i.xBx,{justify:I.Z.Justify.BETWEEN,children:[(0,l.jsx)(I.Z.Child,{grow:1,children:(0,l.jsx)(i.X6q,{variant:"heading-lg/semibold",children:Z.intl.string(Z.t.PphjtL)})}),(0,l.jsx)(I.Z.Child,{grow:0,children:(0,l.jsx)(i.olH,{onClick:this.close})})]}),(0,l.jsxs)(i.hzk,{children:[(0,l.jsxs)(I.Z,{align:I.Z.Align.CENTER,children:[(0,l.jsx)(m.Z,{game:t,size:m.Z.Sizes.MEDIUM,className:S.gameIcon}),(0,l.jsx)("div",{className:S.gameName,children:null!=t&&t.name}),null!=e?(0,l.jsx)("div",{className:S.installSize,children:(0,T.BU)(e,{useKibibytes:!0})}):null]}),(0,l.jsx)("div",{className:S.divider}),(0,l.jsx)(A.Z,{autoFocus:!0,className:S.selector,value:n,requiredDiskKB:e,onChange:this.handleChangePath}),(0,l.jsx)(c.Z,{eulaId:t.eulaId,applicationName:t.name,disabled:a,onChange:this.handlePurchaseTermsChange,className:S.terms})]}),(0,l.jsx)(i.mzw,{children:this.renderButton()})]})}constructor(...t){super(...t),L(this,"state",{selectedInstallationPath:this.props.defaultInstallationPath,hasError:!1,isInstalling:!1,hasAcceptedNeccessaryTerms:!1}),L(this,"isUnmounted",!1),L(this,"handleChangePath",(t,e)=>{this.setState({selectedInstallationPath:t,hasError:e})}),L(this,"install",(t,e)=>{let{application:s,branchId:l,analyticsLocation:n}=this.props;if(null==s)return null;(0,u.LO)({application:s,branchId:l,buildId:t,manifestIds:e,installationPath:this.state.selectedInstallationPath,analyticsLocation:n}),(0,g.uL)(C.Z5c.APPLICATION_LIBRARY),this.close()}),L(this,"handleInstall",()=>{let{application:t,buildId:e,manifestIds:s,hasPreviouslyAcceptedStoreTerms:l}=this.props;if(null!=e&&null!=s)l||(0,d.B)(),null!=t&&null!=t.eulaId&&(0,d.D)(t.eulaId),this.install(e,s);else throw Error("Unexpected missing build info for non-premium product")}),L(this,"handlePurchaseTermsChange",t=>{this.setState({hasAcceptedNeccessaryTerms:t})}),L(this,"close",()=>{this.props.onClose()})}}let E=a.ZP.connectStores([f.Z,_.Z,P.Z,p.Z],t=>{let{applicationId:e,branchId:s}=t,l=f.Z.getTargetBuildId(e,s);return{application:p.Z.getApplication(e),defaultInstallationPath:_.Z.defaultInstallationPath,buildId:l,manifestIds:f.Z.getTargetManifests(e,s),buildSizeKB:null!=l?f.Z.getBuildSize(l):null,hasPreviouslyAcceptedStoreTerms:P.Z.hasAcceptedStoreTerms}})(b)},94692:function(t,e,s){s.d(e,{Z:()=>g}),s(653041),s(47120);var l=s(200651),n=s(192379),a=s(442837),i=s(481060),r=s(325432),h=s(391690),o=s(424218),d=s(998502),u=s(388032),c=s(154229);function p(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}let I="select";class m extends n.PureComponent{fetchAllDirectoryMetadata(){let{installationPaths:t}=this.props,e=t.map(t=>{let{path:e}=t;return e}),{newInstallationPath:s}=this.state;for(let t of(null!=s&&e.push(s),e=e.filter(t=>!this.fetchedMetadataPaths.has(t)),(0,r.ec)(e),e))this.fetchedMetadataPaths.add(t)}componentDidMount(){this.fetchAllDirectoryMetadata()}componentDidUpdate(t){this.fetchAllDirectoryMetadata(),(this.props.requiredDiskKB!==t.requiredDiskKB||this.props.installationPathsMetadata!==t.installationPathsMetadata)&&this.sendChange(this.props.value)}getOptions(){let{installationPaths:t}=this.props,{newInstallationPath:e}=this.state,s=t.map(t=>{let{path:e,label:s}=t;return{value:e,label:this.renderLabel(e,s)}});return null!=e&&s.push({value:e,label:this.renderLabel(e)}),s.push({value:I,label:u.intl.string(u.t["cL/rrq"])}),s}hasEnoughDiskSpace(t){let{requiredDiskKB:e,installationPathsMetadata:s}=this.props,l=null!=s[t]?s[t].availableKB:null;return null==e||null==l||e<l}sendChange(t){let{installationPathsMetadata:e,onChange:s}=this.props,l=null!=e[t]&&!1===e[t].hasPermission;s(t,l||!this.hasEnoughDiskSpace(t))}renderError(){let{value:t,installationPathsMetadata:e}=this.props;return null!=e[t]&&!1===e[t].hasPermission?(0,l.jsx)("div",{className:c.error,children:u.intl.string(u.t.cEUT8P)}):this.hasEnoughDiskSpace(t)?null:(0,l.jsx)("div",{className:c.error,children:u.intl.string(u.t.duXbEx)})}renderLabel(t,e){let{installationPathsMetadata:s}=this.props,l=null!=e?e:t;return null!=s[t]&&null!=s[t].availableKB?u.intl.formatToPlainString(u.t["Y+M3rq"],{path:l,size:(0,o.BU)(s[t].availableKB,{useKibibytes:!0})}):l}render(){let{value:t,className:e,autoFocus:s}=this.props;return(0,l.jsxs)("div",{className:e,children:[(0,l.jsx)(i.vwX,{tag:"h5",children:u.intl.string(u.t.WTJuNj)}),(0,l.jsx)(i.q4e,{autoFocus:s,options:this.getOptions(),value:t,onChange:this.handleChange}),this.renderError()]})}constructor(...t){super(...t),p(this,"state",{newInstallationPath:null}),p(this,"fetchedMetadataPaths",new Set),p(this,"handleChange",t=>{t===I?d.ZP.showOpenDialog(["openDirectory"]).then(t=>{if(null!=t&&t.length>0){let e=t[0];this.setState({newInstallationPath:null!=this.props.installationPaths.find(t=>{let{path:s}=t;return s===e})?null:e}),this.sendChange(e)}}):this.sendChange(t)})}}let g=a.ZP.connectStores([h.Z],()=>({installationPaths:h.Z.installationPaths,installationPathsMetadata:h.Z.installationPathsMetadata}))(m)},560121:function(t,e,s){t.exports={splash:"splash__15293",gameIcon:"gameIcon__15293",gameName:"gameName__15293",installSize:"installSize__15293",divider:"divider__15293",selector:"selector__15293",terms:"terms__15293"}},154229:function(t,e,s){t.exports={error:"error__6e36d"}}}]);
//# sourceMappingURL=87383be7ec8182c3.js.map