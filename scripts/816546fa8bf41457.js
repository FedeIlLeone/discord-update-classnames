"use strict";(this.webpackChunkdiscord_app=this.webpackChunkdiscord_app||[]).push([["32633"],{850085:function(e,t,n){n.d(t,{default:()=>f}),n(47120),n(411104);var i=n(200651),r=n(192379),a=n(392711),o=n(36793),l=n(481060),s=n(100527),u=n(906732),c=n(540059),d=n(488499),h=n(222062),_=n(530329),m=n(626135),g=n(197712),p=n(511004),x=n(486324),C=n(981631),w=n(678916),y=n(388032),v=n(2382);let f=e=>{let{file:t,imgURI:n,transitionState:f,allowSkip:E=!1,onCrop:A,onClose:k,uploadType:R=x.pC.AVATAR,showUpsellHeader:b=!1,analyticsPage:B}=e,[N,D]=r.useState({width:0,height:0}),[M,j]=r.useState({top:0,bottom:0,left:0,right:0}),[L,z]=r.useState(!1),[I,S]=r.useState(1),[G,O]=r.useState({x:0,y:0}),[P,T]=r.useState(null),[H,U]=r.useState(!1),{analyticsLocations:V}=(0,u.ZP)(s.Z.IMAGE_CROPPING_MODAL),X=(0,c.Q3)("ImageCroppingNModal"),F=r.useRef({x:0,y:0}),Y=r.useRef(null),W=r.useRef(null),Z="image/gif"===t.type;r.useEffect(()=>{(0,p.Z)()},[]),r.useEffect(()=>{Z&&b&&m.default.track(C.rMx.OPEN_MODAL,{type:C.jXE.CROP_GIF_MODAL,location:{page:B}})},[b,B,Z]);let K=()=>{switch(R){case x.pC.BANNER:return{height:x.f,width:x.L0};case x.pC.VIDEO_BACKGROUND:return w.HE;case x.pC.AVATAR:case x.pC.AVATAR_DECORATION:return{height:C.dGM,width:C.dGM};case x.pC.GUILD_BANNER:return{height:x._T,width:x.X_};case x.pC.SCHEDULED_EVENT_IMAGE:return{height:x.xT,width:x.d6};case x.pC.HOME_HEADER:return{height:x.Uo,width:x.N8}}},$=r.useCallback((e,t,n)=>{F.current=(0,g.U$)(e,t,n),null!=Y.current&&(Y.current.style.transform="translate3d(".concat(F.current.x,"px, ").concat(F.current.y,"px, 0)"))},[Y]),q=r.useCallback(()=>{if(null==Y.current||I>1)return;let{width:e,height:t}=Y.current.getBoundingClientRect(),{width:n,height:i}=(0,g.Es)(R,e,t,X),r=(0,g.AK)(R,n,i,t,X);T({width:n,height:i}),D(r),j((0,g.kH)(n,i,r))},[X,R,I]),Q=r.useCallback(e=>{let{x:t,y:n}=F.current;if(L&&(e.clientX!==t||e.clientY!==n))$(e.clientX-G.x,e.clientY-G.y,M)},[M,L,G,$]),J=()=>{z(!1)},ee=()=>{let e=K();return e.width!==e.height},et=async()=>{let e;if(null==Y.current)return;U(!0);let n=Y.current,i=K();if(Z)try{let{result:r,cancelFn:a}=await (0,g.$p)({file:t,image:n,cropDimensions:N,cropOriginCoordinates:F.current,maxDimensions:i});W.current=a,e=await r,W.current=null}catch(e){var r;throw null===(r=W.current)||void 0===r||r.call(W),W.current=null,Error("Error cropping GIF")}else e=(0,o.PT)({image:n,cropDimensions:N,cropOriginCoordinates:F.current,maxDimensions:i});await A(e,t),U(!1),k()};r.useEffect(()=>(window.addEventListener("mouseup",J),window.addEventListener("resize",q),()=>{window.removeEventListener("mouseup",J),window.removeEventListener("resize",q)}),[q]),r.useEffect(()=>()=>{null!=W.current&&W.current()},[]),r.useEffect(()=>{if(L)return window.addEventListener("mousemove",Q),()=>window.removeEventListener("mousemove",Q)},[Q,L]);let en=R===x.pC.AVATAR||R===x.pC.BANNER,ei=(0,h.M)(!en);return(0,i.jsx)(u.Gt,{value:V,children:(0,i.jsxs)(l.Y0X,{onAnimationEnd:q,transitionState:f,size:l.CgR.MEDIUM,children:[b&&!ei&&(0,i.jsx)(d.Z,{type:R,analyticsPage:B,analyticsSection:C.jXE.CROP_GIF_MODAL,isGIF:Z,banner:n}),(0,i.jsx)(l.xBx,{separator:!1,children:(0,i.jsx)(l.vwX,{className:v.titleCase,tag:l.RB0.H1,children:y.intl.string(y.t.DxAYCA)})}),(0,i.jsxs)(l.hzk,{className:v.modalContent,children:[(0,i.jsxs)("div",{className:v.editingContainer,children:[(0,i.jsx)("img",{style:{opacity:null==P?0:1,transform:"translate3d(".concat(F.current.x,"px, ").concat(F.current.y,"px, 0px)"),...(()=>{if(null==P)return{};let e=P.width/P.height,t=ee()&&e>x.MY?N.height/P.height:1;return{width:P.width*I*t,minWidth:P.width*I*t,height:P.height*I*t}})()},className:H?v.imageDisabled:v.imageEnabled,src:n,alt:"avatar",ref:Y,onMouseDown:e=>{O({x:e.clientX-F.current.x,y:e.clientY-F.current.y}),z(!0)},draggable:!1}),(0,i.jsx)("div",{className:R===x.pC.AVATAR?v.overlayAvatar:v.overlayBanner,style:{opacity:null==P?0:1,width:N.width,height:N.height}})]}),(0,i.jsxs)("div",{className:v.sliderContainer,children:[(0,i.jsx)(l.XBm,{size:"md",color:"currentColor",className:v.icon}),(0,i.jsx)(l.iRW,{initialValue:1,minValue:1,maxValue:2,keyboardStep:.025,asValueChanges:e=>{if(null==P)return;let{width:t,height:n}=P,i=(0,g.kH)(t*e,n*e,N),{x:r,y:o}=F.current;(0,a.inRange)(r,i.right,i.left)&&(0,a.inRange)(o,i.top,i.bottom)||$(r,o,i),S(e),j(i)},disabled:H,equidistant:!0,hideBubble:!0,"aria-label":y.intl.string(y.t.dnvZSk)}),(0,i.jsx)(l.XBm,{size:"custom",color:"currentColor",className:v.icon,width:48,height:48})]}),b&&ei&&(0,i.jsx)("div",{children:(0,i.jsx)(_.Z,{uploadType:R,showUpsell:!0,position:"inline",className:v.nitroUpsell,showShadow:!1})})]}),(0,i.jsxs)(l.mzw,{className:v.modalFooter,children:[E?(0,i.jsx)(l.zxk,{className:v.cancelButton,look:l.zxk.Looks.LINK,color:l.zxk.Colors.PRIMARY,size:l.PhG.SMALL,onClick:()=>{E&&(A(n,t),k())},children:y.intl.string(y.t.B944ys)}):null,(0,i.jsxs)("div",{className:v.buttonsRight,children:[(0,i.jsx)(l.zxk,{className:v.cancelButton,look:l.zxk.Looks.LINK,color:l.zxk.Colors.PRIMARY,size:l.PhG.SMALL,onClick:()=>{if(null!=W.current){W.current(),W.current=null,U(!1);return}k()},children:y.intl.string(y.t["9TG40t"])}),(0,i.jsx)(l.zxk,{submitting:H,size:l.PhG.SMALL,onClick:et,children:y.intl.string(y.t.ZSHmKC)})]})]})]})})}},73620:function(e,t,n){n.d(t,{default:()=>l});var i=n(200651),r=n(373230),a=n(850085),o=n(712451);function l(e){let{allowSkip:t,...n}=e,{enabled:l}=r.i3.useExperiment({location:"ImageEditingModalExperimentWrapper"},{autoTrackExposure:!1});return l?(0,i.jsx)(o.default,{...n}):(0,i.jsx)(a.default,{...n,allowSkip:t})}},36793:function(e,t,n){function i(e){let{image:t,cropDimensions:n,cropOriginCoordinates:i,maxDimensions:r,imageRotation:a=0}=e,o=t.naturalWidth/t.width,l=function(e,t){let{x:n,y:i}=e;switch(t){case 90:return{x:i,y:-n};case 180:return{x:-n,y:-i};case 270:return{x:-i,y:n};default:return{x:n,y:i}}}(i,a),s=a%180!=0,u=n.width*o,c=n.height*o,d=Math.min(u,r.width),h=Math.min(c,r.height),_=(s?n.height:n.width)/2,m=(s?n.width:n.height)/2,g=(t.width/2-_-l.x)*o,p=(t.height/2-m-l.y)*o,x=s?c:u,C=s?u:c,{x:w,y:y}=function(e,t,n){switch(n){case 0:return{x:0,y:0};case 90:return{x:0,y:-e};case 180:return{x:-e,y:-t};case 270:return{x:-t,y:0}}}(u,c,a);return{sourceX:g,sourceY:p,sourceWidth:x,sourceHeight:C,destinationX:w,destinationY:y,destinationWidth:s?h:d,destinationHeight:s?d:h,canvasWidth:d,canvasHeight:h}}function r(e){let{image:t,cropDimensions:n,cropOriginCoordinates:r,maxDimensions:a,imageRotation:o=0}=e,{sourceX:l,sourceY:s,sourceWidth:u,sourceHeight:c,destinationX:d,destinationY:h,destinationWidth:_,destinationHeight:m,canvasWidth:g,canvasHeight:p}=i({image:t,cropDimensions:n,cropOriginCoordinates:r,maxDimensions:a,imageRotation:o}),x=document.createElement("canvas");x.width=g,x.height=p;let C=x.getContext("2d");return null!=C&&(C.rotate(o*Math.PI/180),C.drawImage(t,l,s,u,c,d,h,_,m)),x.toDataURL("image/png")}function a(e,t,n){let i=e.naturalWidth/e.naturalHeight,a=t,o=n;e.naturalWidth>e.naturalHeight?a/=i:o*=i;let l={height:a,width:o};return r({image:e,cropDimensions:{width:e.width,height:e.height},cropOriginCoordinates:{x:0,y:0},maxDimensions:l})}n.d(t,{Ae:()=>a,GS:()=>i,PT:()=>r})},2382:function(e,t,n){e.exports={modalContent:"modalContent__11787",editingContainer:"editingContainer__11787",image:"image__11787",imageEnabled:"imageEnabled__11787 image__11787",imageDisabled:"imageDisabled__11787 image__11787",icon:"icon__11787",overlay:"overlay__11787",overlayAvatar:"overlayAvatar__11787 overlay__11787",overlayBanner:"overlayBanner__11787 overlay__11787",sliderContainer:"sliderContainer__11787",nitroUpsell:"nitroUpsell__11787",cancelButton:"cancelButton__11787",modalFooter:"modalFooter__11787",buttonsRight:"buttonsRight__11787",titleCase:"titleCase__11787"}},91536:function(e,t,n){e.exports={modalHeader:"modalHeader__57752",modalCloseButton:"modalCloseButton__57752",modalContent:"modalContent__57752",editingContainer:"editingContainer__57752",image:"image__57752",rotationSupported:"rotationSupported__57752",imageEnabled:"imageEnabled__57752 image__57752",imageDisabled:"imageDisabled__57752 image__57752",overlay:"overlay__57752",overlayAvatar:"overlayAvatar__57752 overlay__57752",overlayBanner:"overlayBanner__57752 overlay__57752",toolsContainer:"toolsContainer__57752",zoomControls:"zoomControls__57752",zoomIcon:"zoomIcon__57752",slider:"slider__57752",rotateButton:"rotateButton__57752",premiumUpsell:"premiumUpsell__57752",modalFooter:"modalFooter__57752",linkButton:"linkButton__57752",resetButton:"resetButton__57752 linkButton__57752"}}}]);
//# sourceMappingURL=816546fa8bf41457.js.map