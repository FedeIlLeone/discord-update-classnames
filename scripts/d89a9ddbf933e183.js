"use strict";(this.webpackChunkdiscord_app=this.webpackChunkdiscord_app||[]).push([["6380"],{715941:function(t){t.exports="/assets/cc1962559d37a6d1.svg"},317192:function(t){t.exports="/assets/7eb5ad9165537ef6.svg"},309509:function(t){t.exports="/assets/49e200b52c0a66ab.svg"},264298:function(t){t.exports="/assets/eaf420114113c0bc.svg"},969315:function(t){t.exports="/assets/c9d06b948b249c3a.svg"},157118:function(t){t.exports="/assets/c48922675fa3fdb4.svg"},372123:function(t,e,n){n.d(e,{Z:()=>c}),n(411104);var i=n(570140),l=n(710845),a=n(209492),s=n(981631);let o=new l.Z("CloudSync");class r{constructor(t){var e,n;n=void 0,(e="message")in this?Object.defineProperty(this,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[e]=n,this.message=t}}async function c(t,e){let n,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;i.Z.dispatch({type:"GAME_CLOUD_SYNC_START",applicationId:t,branchId:e});try{if((n=await a.j(t,e,l)).type===s.QCD.CONFLICT)throw i.Z.dispatch({type:"GAME_CLOUD_SYNC_CONFLICT",applicationId:t,branchId:e,next:n.next,remote:n.remote}),new r("Conflict in cloud sync.");(n.type===s.QCD.PULL||n.type===s.QCD.PUSH)&&o.info("Sync complete",n)}catch(n){if(n instanceof r)throw n;throw i.Z.dispatch({type:"GAME_CLOUD_SYNC_ERROR",applicationId:t,branchId:e}),o.error("Failed to cloud sync:",n),Error("Failed to cloud sync.")}return i.Z.dispatch({type:"GAME_CLOUD_SYNC_COMPLETE",applicationId:t,branchId:e}),n}},696748:function(t,e,n){n.d(e,{a:()=>O}),n(411104),n(47120);var i=n(200651),l=n(192379),a=n(913527),s=n.n(a),o=n(442837),r=n(481060),c=n(372123),d=n(224706),u=n(812206),p=n(600164),h=n(293245),f=n(626135),C=n(981631),y=n(388032),N=n(885330),m=n(483938);function g(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class A extends l.PureComponent{renderConflictButton(t,e,n,l){return(0,i.jsxs)(r.zxk,{className:N.conflictButton,innerClassName:N.conflictButtonInner,onClick:l,children:[(0,i.jsx)("div",{className:n}),(0,i.jsxs)("div",{className:N.buttonBody,children:[(0,i.jsx)("div",{className:N.conflictTitle,children:t}),(0,i.jsx)("div",{children:y.intl.string(y.t.gflHOz)}),(0,i.jsx)("div",{className:N.timestamp,children:s()(e).calendar()})]})]})}renderError(){let{application:t}=this.props;return(0,i.jsxs)(l.Fragment,{children:[(0,i.jsxs)(r.hzk,{children:[(0,i.jsx)(p.Z,{justify:p.Z.Justify.CENTER,children:(0,i.jsx)("div",{className:N.errorArt})}),(0,i.jsx)("div",{className:N.description,children:y.intl.format(y.t.RAaWyc,{applicationName:t.name})})]}),(0,i.jsx)(r.mzw,{children:(0,i.jsxs)(p.Z,{justify:p.Z.Justify.BETWEEN,children:[(0,i.jsx)(r.zxk,{className:N.linkButton,size:N.linkButtonSize,look:r.zxk.Looks.LINK,color:r.zxk.Colors.PRIMARY,onClick:this.onClose,children:y.intl.string(y.t["ETE/oK"])}),(0,i.jsxs)(p.Z,{direction:p.Z.Direction.HORIZONTAL,justify:p.Z.Justify.END,children:[(0,i.jsx)(r.zxk,{look:r.zxk.Looks.LINK,color:r.zxk.Colors.PRIMARY,onClick:()=>this.handlePlay(),className:N.retryButton,children:y.intl.string(y.t["5911LS"])}),(0,i.jsx)(r.zxk,{onClick:()=>this.handlePlay(!1),children:y.intl.string(y.t["359PbW"])})]})]})})]})}renderConflict(){let{application:t,cloudSyncState:e}=this.props;if(e.type!==C.TzF.CONFLICT)throw Error("Cannot render conflict for non conflict type");return(0,i.jsxs)(r.hzk,{className:m.marginBottom20,children:[(0,i.jsx)("div",{className:N.description,children:y.intl.format(y.t.eyXUPz,{applicationName:t.name})}),this.renderConflictButton(y.intl.string(y.t.AQUmkp),e.remote.timestamp,N.conflictDownloadArt,this.handleChooseDownload),(0,i.jsxs)(p.Z,{className:N.choiceWrapper,align:p.Z.Align.CENTER,children:[(0,i.jsx)("div",{className:N.choiceLine}),(0,i.jsx)("div",{className:N.choiceTitle,children:y.intl.string(y.t.WUsA2N)}),(0,i.jsx)("div",{className:N.choiceLine})]}),this.renderConflictButton(y.intl.string(y.t.AXVws7),e.next.timestamp,N.conflictUploadArt,this.handleChooseUpload)]})}render(){let{cloudSyncState:t,transitionState:e}=this.props,n=t.type===C.TzF.CONFLICT?y.intl.string(y.t.oNbO1d):y.intl.string(y.t.as4Tgo);return(0,i.jsxs)(r.Y0X,{transitionState:e,className:N.modal,"aria-label":n,children:[(0,i.jsxs)(r.xBx,{separator:!1,children:[(0,i.jsx)(r.olH,{className:N.closeButton,onClick:this.onClose}),(0,i.jsx)(r.vwX,{tag:"h2",className:m.marginReset,children:n})]}),t.type===C.TzF.CONFLICT?this.renderConflict():this.renderError()]})}constructor(...t){var e;super(...t),e=this,g(this,"onClose",()=>{this.props.onClose()}),g(this,"handlePlay",function(){let t=!(arguments.length>0)||void 0===arguments[0]||arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,{libraryApplication:i,analyticsParams:l}=e.props;e.onClose(),O(i.id,i,{analyticsParams:l,cloudSync:t,cloudSyncForceHash:n})}),g(this,"handleChooseDownload",()=>{let{cloudSyncState:t}=this.props;t.type===C.TzF.CONFLICT&&this.handlePlay(!0,t.remote.hash)}),g(this,"handleChooseUpload",()=>{let{cloudSyncState:t}=this.props;t.type===C.TzF.CONFLICT&&this.handlePlay(!0,t.next.hash)})}}let T=o.ZP.connectStores([h.Z,u.Z],t=>{let{libraryApplication:e,branchId:n}=t;return{cloudSyncState:h.Z.getState(e.id,n),application:u.Z.getApplication(e.id)}})(A);async function O(t,e,n){let l=u.Z.getApplication(t);if(null==l)return;let{cloudSync:a=!0,cloudSyncForceHash:s=null,analyticsParams:o}=n;if(a&&null!=e){let t=e.branchId;try{await c.Z(e.id,t,s)}catch(n){(0,r.h7j)(n=>(0,i.jsx)(T,{libraryApplication:e,analyticsParams:o,branchId:t,...n}));return}}return f.default.track(C.rMx.APPLICATION_OPENED,{application_id:l.id,application_name:l.name,type:C.q5t.LAUNCH,distributor:null!=e?e.getDistributor():null,...o}),d.Z.launch({applicationId:l.id,branchId:null==e?void 0:e.branchId})}},293245:function(t,e,n){let i,l,a;n.d(e,{Z:()=>g}),n(47120);var s,o,r,c=n(442837),d=n(570140),u=n(372123),p=n(594190),h=n(283595),f=n(780570),C=n(358085),y=n(209492),N=n(981631);class m extends(s=c.ZP.Store){initialize(){C.isPlatformEmbedded&&y.S(),i={},l=new Set,a=[]}getState(t,e){return i[(0,f.Tu)(t,e)]}isSyncing(t,e){let n=(0,f.Tu)(t,e);return l.has(n)}}r="CloudSyncStore",(o="displayName")in m?Object.defineProperty(m,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):m[o]=r;let g=new m(d.Z,{GAME_CLOUD_SYNC_START:function(t){let{applicationId:e,branchId:n}=t,i=(0,f.Tu)(e,n);l.add(i)},GAME_CLOUD_SYNC_UPDATE:function(t){let{state:e}=t;for(let t of Object.keys(e))i[t]=e[t]},GAME_CLOUD_SYNC_COMPLETE:function(t){let{applicationId:e,branchId:n}=t,a=(0,f.Tu)(e,n);return l.delete(a),i[a]={type:N.TzF.DONE,timestamp:Date.now()},!0},GAME_CLOUD_SYNC_CONFLICT:function(t){let{applicationId:e,branchId:n,next:a,remote:s}=t,o=(0,f.Tu)(e,n);i[o]={type:N.TzF.CONFLICT,next:a,remote:s},l.delete(o)},GAME_CLOUD_SYNC_ERROR:function(t){let{applicationId:e,branchId:n}=t,a=(0,f.Tu)(e,n);i[a]={type:N.TzF.ERROR},l.delete(a)},RUNNING_GAMES_CHANGE:function(){let t=p.ZP.getRunningDiscordApplicationIds();for(let e of a.filter(e=>!t.includes(e))){let t=h.Z.getActiveLibraryApplication(e);null!=t&&d.Z.wait(()=>{try{u.Z(t.id,t.branchId)}catch(t){}})}return a=t,!1}})},209492:function(t,e,n){let i;n.d(e,{S:()=>f,j:()=>C}),n(411104);var l=n(544891),a=n(570140),s=n(710845),o=n(893988),r=n(314897),c=n(417363),d=n(780570),u=n(358085),p=n(998502),h=n(981631);async function f(){if(null==i){if(!(u.isPlatformEmbedded&&((0,u.isMac)()||(0,u.isWindows)()))){new s.Z("CloudSyncUtils").warn("CloudSync is not supported on this platform");return}await p.ZP.ensureModule("discord_cloudsync"),(i=new(p.ZP.getCloudSync())).on("state",t=>a.Z.dispatch({type:"GAME_CLOUD_SYNC_UPDATE",state:t}))}}function C(t,e){var n;let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!c.Z.supportsCloudSync(t,e))return Promise.resolve({type:h.QCD.NONE});let s=function(){if(null==i)throw Error("Initialize cloud sync module before syncing.");return i}(),u=c.Z.getState(t,e);if(null==u)throw Error("No dispatch state for ".concat(t,":").concat(e));let p=null!==(n=u.storage)&&void 0!==n?n:{},f=(0,d.Tu)(t,e),C=r.default.getToken();if(null==C)throw Error("Cannot use cloud sync when not authenticated.");let y=null!=u.installPath?(0,o.Z)(u.installPath):null;if(null==y)throw Error("No install path for ".concat(t,":").concat(e));let N=r.default.getId(),m={forceHash:a,manifestPath:h.SRg.STORAGE_MANIFEST(y,N),roots:null!=p.roots?p.roots:[{id:h.SRg.ROOT_ID,paths:Object.keys(h.SRg.ROOT_PLATFORMS).map(t=>({platform:t,path:h.SRg.ROOT_STORAGE_PATH(y,N)})),patterns:h.SRg.ROOT_PATTERN}],storage:{baseURL:"".concat((0,l.K0)()).concat(h.ANM.APPLICATION_STORAGE(t,e)),token:C},replacements:{INSTALLDIR:h.SRg.INSTALL_DIR(y),USERID:N,BRANCHID:e}};return s.sync(f,m)}},702523:function(t,e,n){n.d(e,{L:()=>r});var i=n(200651);n(192379);var l=n(481060),a=n(51025),s=n(850840),o=n(391690);function r(t,e,r,c,d){let u=o.Z.getInstallationPath(t.id,e),p=null!=t.eulaId&&!s.Z.hasAcceptedEULA(t.eulaId);null==u||p?(0,l.ZDy)(async()=>{let{default:l}=await n.e("226").then(n.bind(n,472064));return n=>(0,i.jsx)(l,{...n,applicationId:t.id,branchId:e,analyticsLocation:d})}):(0,a.LO)({application:t,branchId:e,buildId:r,manifestIds:c,installationPath:u,analyticsLocation:d})}},346329:function(t,e,n){n.r(e),n.d(e,{installApplication:()=>p,performDefaultLibraryApplicationAction:()=>C,playApplication:()=>l.a,repairApplication:()=>f,updateApplication:()=>h});var i=n(51025),l=n(696748),a=n(812206),s=n(173747),o=n(7956),r=n(417363),c=n(941128),d=n(702523),u=n(981631);function p(t,e,n){let i=a.Z.getApplication(t);if(null==i)return;let l=s.Z.getTargetBuildId(i.id,e),o=s.Z.getTargetManifests(i.id,e);null!=l&&null!=o&&null!=d.L&&(0,d.L)(i,e,l,o,n)}function h(t,e){let n=a.Z.getApplication(t);if(null!=n)return i.li(n,e,s.Z.getTargetBuildId(n.id,e),s.Z.getTargetManifests(n.id,e))}function f(t,e,n){let l=a.Z.getApplication(t);if(null!=l)return i.cG(l,e,n)}function C(t,e){let n=(0,o.i)(t,r.Z,c.Z),{analyticsParams:i}=e;switch(n){case u.apO.PLAY:return(0,l.a)(t.id,t,{analyticsParams:i});case u.apO.INSTALL:return p(t.id,t.branchId,i.source);case u.apO.UPDATE:return h(t.id,t.branchId)}}}}]);
//# sourceMappingURL=d89a9ddbf933e183.js.map