"use strict";(this.webpackChunkdiscord_app=this.webpackChunkdiscord_app||[]).push([["13351"],{90641:function(t,e,n){n.d(e,{Z:()=>h});var r=n(570140),i=n(668781),a=n(287734),o=n(881052),l=n(314897),c=n(592125),u=n(979651),E=n(352954),s=n(630759),d=n(760373),_=n(981631),f=n(388032);async function S(t,e){if(t){r.Z.dispatch({type:"SECURE_FRAMES_SETTINGS_UPDATE",persistentCodesEnabled:t});try{await (0,s.om)(d.GB),null==e||e()}catch(e){var n;let t=new o.Hx(e);r.Z.dispatch({type:"SECURE_FRAMES_SETTINGS_UPDATE",persistentCodesEnabled:!1}),i.Z.show({title:f.intl.string(f.t.R0RpRU),body:null!==(n=t.getAnyErrorMessage())&&void 0!==n?n:f.intl.string(f.t.eAn6z8)})}}else r.Z.dispatch({type:"SECURE_FRAMES_SETTINGS_UPDATE",persistentCodesEnabled:t}),null==e||e()}let h={clearUploadedKeyVersions:function(){r.Z.dispatch({type:"SECURE_FRAMES_UPLOADED_KEY_VERSION_CLEAR"})},updatePersistentCodesEnabled:async function t(t){let e=function(){let t=u.Z.getVoiceStateForUser(l.default.getId()),e=c.Z.getChannel(null==t?void 0:t.channelId);return l.default.getSessionId()===(null==t?void 0:t.sessionId)&&null!=e&&e.type!==_.d4z.GUILD_STAGE_VOICE?e.id:null}();null!=e?E.Z.openSecureFramesUpdateConfirmation({title:t?f.intl.string(f.t.DRFN1N):f.intl.string(f.t.q29xJy),subtitle:t?f.intl.string(f.t.y015ZW):f.intl.string(f.t.E66FQk),confirmText:f.intl.string(f.t.aTuFYW),onConfirm:async()=>{await S(t,()=>{a.default.disconnect(),a.default.selectVoiceChannel(e)})}}):await S(t)},addUploadedKeyVersion:function(t){r.Z.dispatch({type:"SECURE_FRAMES_UPLOADED_KEY_VERSION_ADD",keyVersion:t})},createSecureFramesVerifiedKey:function(t,e){r.Z.dispatch({type:"SECURE_FRAMES_VERIFIED_KEY_CREATE",userId:t,key:e})},deleteSecureFramesVerifiedKey:function(t,e){r.Z.dispatch({type:"SECURE_FRAMES_VERIFIED_KEY_DELETE",userId:t,serializedKey:e})},deleteSecureFramesUserVerifiedKeys:function(t){r.Z.dispatch({type:"SECURE_FRAMES_USER_VERIFIED_KEYS_DELETE",userId:t})},createSecureFramesTransientKey:function(t,e){r.Z.dispatch({type:"SECURE_FRAMES_TRANSIENT_KEY_CREATE",userId:t,key:e})},deleteSecureFramesTransientKey:function(t){r.Z.dispatch({type:"SECURE_FRAMES_TRANSIENT_KEY_DELETE",userId:t})}}},760373:function(t,e,n){n.d(e,{Eg:()=>d,GB:()=>f,KN:()=>l,WK:()=>a,Xe:()=>s,Xj:()=>S,YP:()=>i,ak:()=>c,iQ:()=>o,tu:()=>_,y6:()=>r});let r=5,i=30,a=3,o=5,l=45,c=3;var u,E,s=((u={}).MATCH="match",u.OTHER_USER_ALREADY_VERIFIED="other_user_already_verified",u.OTHER_USER_INCONSISTENT_KEYS="other_user_inconsistent_keys",u.FINGERPRINT_MISMATCH="fingerprint_mismatch",u.UNABLE_TO_VERIFY="unable_to_verify",u.OTHER_USER_DISCONNECTED="other_user_disconnected",u.CURRENT_USER_DISCONNECTED="current_user_disconnected",u);let d=0;var _=((E={}).RTC_DEBUG_PANEL="rtc_debug_panel",E.RTC_SECURE_FRAMES="rtc_secure_frames",E);let f=1,S=0},352954:function(t,e,n){n.d(e,{Z:()=>l}),n(411104);var r=n(200651);n(192379);var i=n(481060),a=n(981631),o=n(388032);let l={openSecureFramesStreamVerification:function(t,e){(0,i.ZDy)(async()=>{let i=(await n.e("94904").then(n.bind(n,660250))).default;return n=>(0,r.jsx)(i,{streamKey:t,channelId:e,...n})})},openSecureFramesUserVerificationModal:function(t,e,o,l){o()&&(0,i.ZDy)(async()=>{let i=(await n.e("33397").then(n.bind(n,963410))).default;return n=>(0,r.jsx)(i,{userId:t,channelId:e,...n})},{contextKey:l===a.IlC.POPOUT?i.u1M:i.z1l})},openSecureFramesUpdateConfirmation:function(t){let{title:e,subtitle:a,confirmText:l=o.intl.string(o.t["cY+Ooa"]),onConfirm:c}=t;(0,i.ZDy)(async()=>{let{ConfirmModal:t}=await Promise.resolve().then(n.bind(n,481060));return n=>(0,r.jsx)(t,{header:e,confirmText:l,cancelText:o.intl.string(o.t["ETE/oK"]),onConfirm:c,...n,children:(0,r.jsx)(i.Text,{variant:"text-sm/normal",color:"header-secondary",children:a})})})},handleSecureFramesUserVerificationLink:function(t){throw Error("handleSecureFramesUserVerificationLink not implemented")}}},571826:function(t,e,n){n.d(e,{CW:()=>d,DF:()=>h,KA:()=>g,M1:()=>s,PM:()=>f,Pn:()=>y,Rq:()=>E,ih:()=>S,s$:()=>_,sN:()=>u});var r=n(367907),i=n(221292),a=n(592125),o=n(626135),l=n(981631);function c(t){var e;return null===(e=a.Z.getChannel(t))||void 0===e?void 0:e.guild_id}function u(t){let{channelId:e,selectedTab:n}=t;r.ZP.trackWithMetadata(l.rMx.RTC_PANEL_VIEWED,{channel_id:e,guild_id:c(e),selected_tab:n})}function E(t){let{channelId:e,userId:n}=t;r.ZP.trackWithMetadata(l.rMx.E2EE_USER_VERIFICATION_VIEWED,{channel_id:e,guild_id:c(e),...(0,i.QN)({userId:n})})}function s(t){let{channelId:e,userId:n,analyticsLocation:a}=t;r.ZP.trackWithMetadata(l.rMx.E2EE_USER_VERIFIED,{channel_id:e,guild_id:c(e),location:a,...(0,i.QN)({userId:n})})}function d(t){let{channelId:e,userId:n,keyVersion:a,reason:o}=t;r.ZP.trackWithMetadata(l.rMx.E2EE_USER_VERIFICATION_FAILED,{channel_id:e,guild_id:c(e),failure_reason:o,key_version:"".concat(a),...(0,i.QN)({userId:n})})}function _(t){let{channelId:e,userId:n}=t;r.ZP.trackWithMetadata(l.rMx.E2EE_USER_VERIFICATION_CODE_COPIED,{channel_id:e,guild_id:c(e),...(0,i.QN)({userId:n})})}function f(t){let{channelId:e}=t;r.ZP.trackWithMetadata(l.rMx.E2EE_CALL_VERIFICATION_CODE_COPIED,{channel_id:e,guild_id:c(e)})}function S(t){let{channelId:e}=t;r.ZP.trackWithMetadata(l.rMx.E2EE_STREAM_VERIFICATION_CODE_COPIED,{channel_id:e,guild_id:c(e)})}function h(){o.default.track(l.rMx.E2EE_SETTINGS_USER_DELETE)}function y(){o.default.track(l.rMx.E2EE_SETTINGS_DEVICE_DELETE)}function g(t){o.default.track(l.rMx.E2EE_PUBLIC_KEY_MISMATCH,{key_version:"".concat(t)})}},630759:function(t,e,n){n.d(e,{J6:()=>k,LO:()=>K,TQ:()=>F,UB:()=>W,ZU:()=>P,Zn:()=>w,aZ:()=>D,bo:()=>L,fz:()=>H,kK:()=>V,lg:()=>G,om:()=>x,pL:()=>M,uV:()=>Z,uX:()=>B}),n(518263),n(970173),n(520712),n(268111),n(941497),n(32026),n(480839),n(744285),n(492257),n(873817),n(47120);var r=n(250683),i=n(512722),a=n.n(i),o=n(913527),l=n.n(o),c=n(544891),u=n(253135),E=n(668781),s=n(314897),d=n(131951),_=n(19780),f=n(959457),S=n(594174),h=n(70956),y=n(63063),g=n(5192),I=n(960048),T=n(51144),R=n(90641),p=n(615830),U=n(352954),C=n(571826),A=n(760373),m=n(981631),N=n(388032);function Z(){return y.Z.getArticleURL(m.BhN.END_TO_END_ENCRYPTION)}function D(){return y.Z.getArticleURL(m.BhN.END_TO_END_ENCRYPTION)}function M(){return y.Z.getArticleURL(m.BhN.END_TO_END_ENCRYPTION)}function F(t,e,n,r,i){n?R.Z.createSecureFramesVerifiedKey(t,e):R.Z.createSecureFramesTransientKey(t,e),(0,C.M1)({channelId:r,userId:t,analyticsLocation:i})}function K(t,e,n){if(n){let n=(0,u.MK)(new Uint8Array(e));R.Z.deleteSecureFramesVerifiedKey(t,n)}else R.Z.deleteSecureFramesTransientKey(t)}function P(t,e){U.Z.openSecureFramesUpdateConfirmation({title:N.intl.string(N.t["hdL15+"]),subtitle:N.intl.string(N.t["8VGYKi"]),onConfirm:()=>{R.Z.deleteSecureFramesVerifiedKey(t,e),(0,C.Pn)()}})}function w(t){let e=S.default.getUser(t),n=T.ZP.getName(e);U.Z.openSecureFramesUpdateConfirmation({title:N.intl.formatToPlainString(N.t.K6NGBw,{username:n}),subtitle:N.intl.string(N.t.F1BQKy),onConfirm:()=>{R.Z.deleteSecureFramesUserVerifiedKeys(t),(0,C.DF)()}})}function L(t){let e=l()(t),n=l()().diff(e,"s");if(n>12*h.Z.Seconds.DAYS_30){let t=Math.round(n/(12*h.Z.Seconds.DAYS_30));return N.intl.formatToPlainString(N.t.F1wqkJ,{count:t})}if(n>h.Z.Seconds.DAYS_30){let t=Math.round(n/h.Z.Seconds.DAYS_30);return N.intl.formatToPlainString(N.t["iT+b+/"],{count:t})}if(n>7*h.Z.Seconds.DAY){let t=Math.round(n/(7*h.Z.Seconds.DAY));return N.intl.formatToPlainString(N.t.dLurKS,{count:t})}if(n>h.Z.Seconds.DAY){let t=Math.round(n/h.Z.Seconds.DAY);return N.intl.formatToPlainString(N.t.LE8a2N,{count:t})}if(n>h.Z.Seconds.HOUR){let t=Math.round(n/h.Z.Seconds.HOUR);return N.intl.formatToPlainString(N.t.KULxVV,{count:t})}else{if(!(n>h.Z.Seconds.MINUTE))return N.intl.formatToPlainString(N.t["/w0Qp6"],{count:n});let t=Math.round(n/h.Z.Seconds.MINUTE);return N.intl.formatToPlainString(N.t.ws6rWl,{count:t})}}function V(t){let{isCurrentUserKeyPersistent:e,isOtherUserKeyPersistent:n,otherUserNickname:r}=t;return e&&n?N.intl.format(N.t["FJN+kp"],{helpArticle:Z()}):e?N.intl.format(N.t["p/9PGh"],{username:r,helpArticle:Z()}):n?N.intl.format(N.t["qT5z8/"],{helpArticle:Z()}):N.intl.format(N.t["6JLy+v"],{helpArticle:Z()})}async function b(t){let e=s.default.getStaticAuthSessionId();return a()(null!=e,"[getCurrentUserPublicKey] session id should not be null"),await d.Z.getMLSSigningKey(e,t)}function O(t){let e=r.fromByteArray(new Uint8Array(t));return"data:application/octet-stream;base64,".concat(e)}async function k(t,e,n){try{return(await c.tn.post({url:m.ANM.VOICE_MATCH_PUBLIC_KEY(t),body:{public_key:O(e),key_version:n},rejectWithError:!1})).body.is_match}catch(t){throw I.Z.captureException(t),t}}async function Y(t){let{key:e,signature:n}=await b(t);try{await c.tn.put({url:m.ANM.VOICE_PUBLIC_KEYS(),body:{public_key:O(e),signature:O(n),key_version:t},rejectWithError:!1}),R.Z.addUploadedKeyVersion(t)}catch(t){throw I.Z.captureException(t),t}}function v(t){return p.Z.getUploadedKeyVersionsCached().includes(t)}async function x(t){v(t)||await Y(t)}async function B(t){if(!v(t))return await Y(t),!0;let e=s.default.getId(),{key:n}=await b(t),r=await k(e,n,t);return r||(0,C.KA)(t),r}function W(t,e){let[n,r]=e;if(!n.isUserConnected(t))return!1;let i=n.getSecureFramesRosterMapEntry(t);if(null==i)return!1;let a=new Uint8Array(i);for(let e of r.getAllActiveStreamKeys()){if(!r.isUserConnected(e,t))continue;let n=f.Z.getSecureFramesRosterMapEntry(e,t);if(null==n)return!0;let i=new Uint8Array(n);for(let t=0;t<a.length;t++)if(a[t]!==i[t])return!0}return!1}function G(t){let{userId:e,channelId:n,nickname:r}=t;(0,C.CW)({userId:e,channelId:n,keyVersion:A.GB,reason:A.Xe.OTHER_USER_INCONSISTENT_KEYS}),E.Z.show({title:N.intl.string(N.t.mznLyc),body:N.intl.format(N.t.WY6IKS,{username:r})})}function H(t){let{userId:e,guildId:n,channelId:r}=t;if(!W(e,[_.Z,f.Z]))return!0;{let t=S.default.getUser(e),i=g.ZP.getName(n,r,t);return G({userId:e,channelId:r,nickname:i}),!1}}},438882:function(t,e,n){n.d(e,{D:()=>r}),n(411104);function r(t,e,n){if(t.byteLength<e)throw Error("data.byteLength must be greater than or equal to desiredLength");if(e%n!=0)throw Error("desiredLength must be a multiple of groupSize");if(n>8)throw Error("groupSize must be less than or equal to ".concat(8));let r=BigInt(10**n),i="";for(let a=0;a<e;a+=n){let e=BigInt(0);for(let r=n;r>0;--r)e=e<<8n|BigInt(t[a+(n-r)]);e%=r,i+=e.toString().padStart(n,"0")}return i}},309651:function(t,e,n){n.d(e,{x:()=>r}),n(411104),n(518263),n(970173),n(520712),n(268111),n(941497),n(32026),n(480839),n(744285),n(492257),n(873817);async function r(t,e,n){if(0!==t)throw Error("unsupported fingerprint format version");if(0===e.byteLength)throw Error("zero-length key");if(0===n.length)throw Error("zero-length user ID");let r=BigInt(n);if(r<0n||r>=2n**64n)throw Error("user ID out of range");let i=new Uint8Array(2+e.byteLength+8);i.set(e,2);let a=new DataView(i.buffer);return a.setUint16(0,t),a.setBigUint64(2+e.byteLength,r),i}},926188:function(t,e,n){n.d(e,{I:()=>c}),n(518263),n(970173),n(520712),n(268111),n(941497),n(32026),n(480839),n(744285),n(492257),n(873817),n(963458),n(47120);var r=n(309651),i=n(802667);let a=Uint8Array.of(36,202,177,122,122,248,236,43,130,180,18,185,45,171,25,46),o={N:16384,r:8,p:2,dkLen:64};function l(t,e){for(let n=0;n<t.length&&n<e.length;n++)if(t[n]!=e[n])return t[n]-e[n];return t.length-e.length}async function c(t,e,n,c,u){let E=await Promise.all([(0,r.x)(t,e,n),(0,r.x)(t,c,u)]);E.sort(l);let s=new Uint8Array(E[0].byteLength+E[1].byteLength);return s.set(E[0],0),s.set(E[1],E[0].byteLength),new Uint8Array(await (0,i.E)(s,a,o))}},253135:function(t,e,n){n.d(e,{Dq:()=>r.D,Il:()=>i.I,MK:()=>a.M});var r=n(438882);n(309651);var i=n(926188),a=n(256147)}}]);
//# sourceMappingURL=3fa6348daf7cecf3.js.map