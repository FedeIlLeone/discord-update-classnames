"use strict";(this.webpackChunkdiscord_app=this.webpackChunkdiscord_app||[]).push([["84956"],{986197:function(e,t,n){n.d(t,{Z:()=>E});var i=n(990547),o=n(544891),a=n(570140),r=n(881052),s=n(626135),l=n(573261),u=n(545851),d=n(109488),g=n(794099),c=n(981631);n(135200);var m=n(388032);let E={resetSuggestions:()=>a.Z.dispatch({type:"POMELO_SUGGESTIONS_RESET"}),async fetchSuggestionsRegistration(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1500;if((0,g.vc)()){a.Z.dispatch({type:"POMELO_SUGGESTIONS_RESET"});try{var n;let i=await o.tn.get({url:c.ANM.POMELO_SUGGESTIONS_UNAUTHED,query:null==e?void 0:{global_name:e},timeout:t,rejectWithError:!0});if(i.ok&&(null===(n=i.body)||void 0===n?void 0:n.username)!=null)return a.Z.dispatch({type:"POMELO_REGISTRATION_SUGGESTIONS_SUCCESS",suggestion:i.body,source:e})}catch(e){return}}},async fetchSuggestions(e){if((0,d.P)())try{var t;a.Z.dispatch({type:"POMELO_SUGGESTIONS_FETCH",usernameSuggestionLoading:!0});let n=await o.tn.get({url:c.ANM.POMELO_SUGGESTIONS,timeout:e,rejectWithError:!0});if(n.ok&&(null===(t=n.body)||void 0===t?void 0:t.username)!=null)return a.Z.dispatch({type:"POMELO_SUGGESTIONS_SUCCESS",suggestion:n.body})}catch(e){return}},async attemptPomelo(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"modal",o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],g=!1===/^[A-Za-z0-9_.]*$/.test(e)?m.intl.string(m.t.z7c4bG):e.includes("..")?m.intl.string(m.t["C7G+go"]):e.length<2||e.length>32?m.intl.formatToPlainString(m.t.IpijXF,{maxNum:32,minNum:2}):void 0;if(null!=g)return s.default.track(c.rMx.POMELO_ERRORS,{reason:g,username_error:!0,location:n,one_click_flow:d}),a.Z.dispatch({type:"POMELO_ATTEMPT_FAILURE",username:e,error:g});if((0,u.E)())try{let t=await l.Z.post({url:o?c.ANM.POMELO_ATTEMPT_UNAUTHED:c.ANM.POMELO_ATTEMPT,body:{username:e},trackedActionData:{event:i.NetworkActionNames.POMELO_ATTEMPT,properties:{requested_username:e}},rejectWithError:!1});t.body.taken&&s.default.track(c.rMx.POMELO_ERRORS,{reason:"already_taken",username_error:!0,location:n,one_click_flow:d}),a.Z.dispatch({type:"POMELO_ATTEMPT_SUCCESS",username:e,taken:t.body.taken})}catch(l){let i=new r.Hx(l),o=null!==(t=i.getAnyErrorMessage())&&void 0!==t?t:void 0;s.default.track(c.rMx.POMELO_ERRORS,{reason:o,username_error:!0,location:n,one_click_flow:d}),a.Z.dispatch({username:e,type:"POMELO_ATTEMPT_FAILURE",error:null!=i.status&&i.status<500&&401!==i.status?o:void 0,statusCode:i.status,retryAfter:i.retryAfter})}},async createPomelo(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=await l.Z.post({body:e,url:c.ANM.POMELO_CREATE,trackedActionData:{event:i.NetworkActionNames.POMELO_CREATE,properties:{one_click_flow:t}},rejectWithError:!1});return a.Z.dispatch({type:"CURRENT_USER_UPDATE",user:n.body}),n.body}}},545851:function(e,t,n){n.d(t,{E:()=>o});let i=(0,n(818083).B)({kind:"user",label:"Pomelo Attempt",id:"2023-04_pomelo_attempt",defaultConfig:{enabled:!1},treatments:[{id:1,label:"enabled",config:{enabled:!0}}]}),o=()=>i.getCurrentConfig({location:"c22166_1"},{autoTrackExposure:!1}).enabled},654344:function(e,t,n){n.d(t,{c:()=>o});let i=(0,n(818083).B)({kind:"user",label:"Pomelo Debounce Delay",id:"2023-03_pomelo_debounce_delay",defaultConfig:{delay:600},treatments:[{id:1,label:"600ms",config:{delay:600}},{id:2,label:"700ms",config:{delay:700}},{id:3,label:"800ms",config:{delay:800}},{id:4,label:"900ms",config:{delay:900}},{id:5,label:"1000ms",config:{delay:1e3}}]}),o=()=>i.useExperiment({location:"52560d_1"},{autoTrackExposure:!1}).delay},135200:function(e,t,n){n.d(t,{Z:()=>E});var i,o,a,r=n(31775),s=n.n(r),l=n(442837),u=n(570140),d=n(70956);let g={taken:null,error:void 0,rateLimited:!0},c={validations:new(s())({max:100,maxAge:6e4}),currentUsernameInvalid:!1,retryAfterTime:null,suggestions:{migration:{suggestion:{username:void 0},fetched:!1,usernameSuggestionLoading:!1},registration:{suggestion:{username:void 0},source:void 0,fetched:!1}}};class m extends(a=l.ZP.Store){isRateLimited(){return null!=c.retryAfterTime&&Date.now()<c.retryAfterTime}validate(e){let t=c.validations.get(e);return this.isRateLimited()&&(null==t||t.rateLimited)?g:this.isRateLimited()||null==t||!t.rateLimited?t:void 0}registrationUsernameSuggestion(){return c.suggestions.registration.suggestion.username}usernameSuggestion(){return c.suggestions.migration.suggestion.username}usernameSuggestionLoading(){return c.suggestions.migration.usernameSuggestionLoading}isCurrentUsernameInvalid(){return c.currentUsernameInvalid}wasRegistrationSuggestionFetched(e){return c.suggestions.registration.source===e&&c.suggestions.registration.fetched}wasSuggestionsFetched(){return c.suggestions.migration.fetched}}o="PomeloStore",(i="displayName")in m?Object.defineProperty(m,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):m[i]=o;let E=new m(u.Z,{POMELO_ATTEMPT_SUCCESS:function(e){let{username:t,taken:n}=e;c.validations.set(t,{taken:n})},POMELO_ATTEMPT_FAILURE:function(e){let{username:t,error:n,statusCode:i,retryAfter:o}=e;429===i?c.validations.set(t,{taken:null,error:n,rateLimited:!0},(null!=o?o:7)*d.Z.Millis.SECOND):c.validations.set(t,{taken:null,error:n}),null!=o&&(c.retryAfterTime=Date.now()+o*d.Z.Millis.SECOND)},POMELO_SUGGESTIONS_RESET:function(){c.suggestions.migration={suggestion:{username:void 0},fetched:!1,usernameSuggestionLoading:!1},c.suggestions.registration={suggestion:{username:void 0},source:void 0,fetched:!1}},POMELO_SUGGESTIONS_SUCCESS:function(e){let{suggestion:t}=e;c.suggestions.migration={suggestion:t,fetched:!0,usernameSuggestionLoading:!1},(null==t?void 0:t.invalid_current_username)===!0&&(c.currentUsernameInvalid=!0)},POMELO_SUGGESTIONS_FETCH:function(e){let{usernameSuggestionLoading:t}=e;c.suggestions.migration.usernameSuggestionLoading=t},POMELO_REGISTRATION_SUGGESTIONS_SUCCESS:function(e){let{suggestion:t,source:n}=e;c.suggestions.registration={suggestion:t,source:n,fetched:!0},(null==t?void 0:t.username)!=null&&c.validations.set(t.username,{taken:!1})}})},109488:function(e,t,n){n.d(t,{P:()=>o});let i=(0,n(818083).B)({kind:"user",label:"Pomelo Suggestions",id:"2023-04_pomelo_suggestions",defaultConfig:{enabled:!1},treatments:[{id:1,label:"enabled",config:{enabled:!0}}]}),o=()=>i.getCurrentConfig({location:"1907ae_1"},{autoTrackExposure:!1}).enabled},794099:function(e,t,n){n.d(t,{F4:()=>o,vc:()=>a});let i=(0,n(818083).B)({kind:"user",id:"2023-06_unique_username_registration",label:"Unique Username Registration",defaultConfig:{livecheckEnabled:!0,suggestions:!0},treatments:[{id:1,label:"Unique Username Registration enabled -livecheck -suggestions",config:{livecheckEnabled:!1,suggestions:!1}},{id:2,label:"Unique Username Registration enabled -livecheck +suggestions",config:{livecheckEnabled:!1,suggestions:!0}},{id:3,label:"Unique Username Registration enabled +livecheck -suggestions",config:{livecheckEnabled:!0,suggestions:!1}},{id:4,label:"Unique Username Registration enabled +livecheck +suggestions",config:{livecheckEnabled:!0,suggestions:!0}}]}),o=()=>i.useExperiment({location:"83ca1a_3"},{autoTrackExposure:!1}),a=()=>i.getCurrentConfig({location:"83ca1a_4"},{autoTrackExposure:!1}).suggestions},363577:function(e,t,n){n.d(t,{M:()=>d});var i=n(192379),o=n(392711),a=n(399606),r=n(986197),s=n(654344),l=n(135200),u=n(346585);let d=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],g=(0,a.e7)([l.Z],()=>l.Z.validate(e),[e]),c=(0,a.e7)([l.Z],()=>l.Z.isRateLimited()),m=(0,s.c)(),E=i.useMemo(()=>(0,o.debounce)(e=>r.Z.attemptPomelo(e,n?"registration":"modal",n,d),m),[m,n,d]);return i.useEffect(()=>{t&&!c&&null==g&&""!==e&&E(e)},[t,c,g,e,E]),i.useMemo(()=>null!=g?(0,u.ti)(g):void 0,[g])}},807369:function(e,t,n){n.d(t,{a:()=>a}),n(47120);var i=n(192379),o=n(363577);let a=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,r=(0,o.M)(e,t,n),[s,l]=i.useState(void 0);return i.useEffect(()=>{""===e||e===a?l(void 0):null!=r&&l(r)},[r,e,a]),s}},180529:function(e,t,n){n.d(t,{Z:()=>u}),n(47120);var i=n(200651),o=n(192379),a=n(642128),r=n(849146),s=n(481060);let l=()=>{let e=o.useRef(null),[t,n]=o.useState(0),i=o.useMemo(()=>new r.Z(e=>{let[t]=e;return n(t.contentRect.height)}),[]);return o.useLayoutEffect(()=>(null!=e.current&&i.observe(e.current),()=>i.disconnect()),[i]),{ref:e,height:t}};function u(e){let{show:t,children:n,top:o=0,bottom:r=0}=e,{ref:u,height:d}=l(),g=(0,s.q_F)({from:{height:0,paddingBottom:"0px",marginTop:"0px"},to:{height:t?d:0,paddingBottom:t?"".concat(r,"px"):"0px",marginTop:t?"".concat(o,"px"):"0px"},config:{tension:170,friction:26}}),c=(0,s.q_F)({from:{opacity:0},to:{opacity:t?1:0},config:{duration:200,easing:t?e=>e**4:e=>e*(2-e)}});return(0,i.jsx)(a.animated.div,{style:{overflow:"hidden",height:g.height,paddingBottom:g.paddingBottom,marginTop:g.marginTop},children:(0,i.jsx)(a.animated.div,{style:{opacity:c.opacity},ref:u,children:n})})}}}]);
//# sourceMappingURL=2152202388839bbd.js.map